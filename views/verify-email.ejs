<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verify Email - Polynumba</title>
    <link rel="stylesheet" href="/style.css">
    <link rel="stylesheet" href="/auth.css">
</head>
<body>
    <!-- Main Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-left">
                <div class="logo">
                    <a href="/" class="logo-link">
                        <div class="logo-container">
                            <img src="/images/polunumba_logo.png" alt="Polynumba Logo" class="logo-image">
                            <span class="logo-text">POLYNUMBA</span>
                        </div>
                    </a>
                </div>
            </div>
            <div class="nav-right">
                <a href="/login" class="nav-link">Already verified? <strong>Sign In</strong></a>
            </div>
        </div>
    </nav>

    <!-- Auth Container -->
    <main class="auth-container">
        <div class="auth-card">
            <div class="auth-header">
                <h1>Verify Your Email</h1>
                <p id="verification-status">
                    <% if (typeof verifying !== 'undefined' && verifying) { %>
                        Verifying your email...
                    <% } else { %>
                        We've sent a verification email to <strong><%= typeof email !== 'undefined' && email ? email : 'your email address' %></strong>
                    <% } %>
                </p>
            </div>

            <% if (typeof error !== 'undefined' && error) { %>
                <div class="error-message"><%= error %></div>
            <% } %>
            
            <% if (typeof success !== 'undefined' && success) { %>
                <div class="success-message"><%= success %></div>
            <% } %>

            <% if (typeof verifying !== 'undefined' && verifying && typeof oobCode !== 'undefined' && oobCode) { %>
                <!-- Auto-verify when oobCode is present -->
                <div class="verification-loading">
                    <div class="spinner"></div>
                    <p>Verifying your email address...</p>
                </div>
                <form id="verify-form" action="/verify-email" method="POST" style="display: none;">
                    <input type="hidden" name="oobCode" value="<%= oobCode %>">
                </form>
            <% } else { %>
                <!-- Verification pending message -->
                <div class="verification-info">
                    <div class="verification-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                            <polyline points="22,6 12,13 2,6"></polyline>
                        </svg>
                    </div>
                    <h2>Check Your Email</h2>
                    <p>We've sent a verification link to:</p>
                    <p class="email-display"><strong><%= typeof email !== 'undefined' && email ? email : 'your email address' %></strong></p>
                    <p>Click the link in the email to verify your account. The link will expire in 1 hour.</p>
                    
                    <div class="verification-actions">
                        <p>Didn't receive the email?</p>
                        <button type="button" id="resend-btn" class="btn-resend">Resend Verification Email</button>
                    </div>
                </div>
            <% } %>

            <div class="auth-divider">
                <span>OR</span>
            </div>

            <div class="auth-footer">
                <p>Already verified? <a href="/login">Sign in here</a></p>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-container">
            <div class="footer-section">
                <h4>Polynumba</h4>
                <p>Professional number prediction platform</p>
            </div>
            <div class="footer-section">
                <h4>Quick Links</h4>
                <ul>
                    <li><a href="/how-to-play" target="_blank">How to Play</a></li>
                    <li><a href="#">Rules</a></li>
                    <li><a href="#">FAQ</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h4>Support</h4>
                <ul>
                    <li><a href="#">Contact Us</a></li>
                    <li><a href="#">Terms of Service</a></li>
                    <li><a href="#">Privacy Policy</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h4>Responsible Gaming</h4>
                <p>18+ Only. Play responsibly.</p>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2024 Polynumba. All rights reserved.</p>
        </div>
    </footer>

    <% if (typeof verifying !== 'undefined' && verifying && typeof oobCode !== 'undefined' && oobCode) { %>
    <script>
        // Auto-submit verification form if oobCode is present
        window.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('verify-form');
            if (form) {
                // Auto-submit after a short delay
                setTimeout(() => {
                    form.submit();
                }, 500);
            }
        });
    </script>
    <% } %>

    <script>
        // Resend verification email
        document.getElementById('resend-btn')?.addEventListener('click', async function() {
            const btn = this;
            const originalText = btn.textContent;
            btn.disabled = true;
            btn.textContent = 'Sending...';
            
            try {
                const response = await fetch('/resend-verification', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    btn.textContent = 'Email Sent!';
                    setTimeout(() => {
                        btn.textContent = originalText;
                        btn.disabled = false;
                    }, 3000);
                } else {
                    alert(data.error || 'Failed to resend email');
                    btn.textContent = originalText;
                    btn.disabled = false;
                }
            } catch (error) {
                console.error('Error resending verification:', error);
                alert('Failed to resend verification email. Please try again.');
                btn.textContent = originalText;
                btn.disabled = false;
            }
        });
    </script>
</body>
</html>

